# CANSAT HEPHAESTUS 2025 FSW2 코드 정리 및 개선 계획

## 📋 개요
이 문서는 CANSAT HEPHAESTUS 2025 FSW2 프로젝트의 코드 정리 및 개선 작업을 체계적으로 진행하기 위한 계획서입니다.

## 🔍 현재 상태 분석

### 1단계: Pitot 관련 파일 완전 제거 ✅
- **완료**: `pitot/` 디렉토리 및 모든 관련 파일 삭제
- **완료**: `test/test_pitot_airspeed.py`, `test/test_pitot.py` 삭제
- **완료**: `PITOT_AIRSPEED_IMPLEMENTATION.md` 삭제
- **확인**: `lib/config.py`, `lib/config.json`에서 pitot 관련 설정 없음
- **확인**: `lib/appargs.py`에서 pitot 관련 앱 정의 없음
- **확인**: `main.py`에서 pitot 관련 import 및 프로세스 생성 코드 없음

### 2단계: 코드 품질 개선 ✅
- **완료**: 빈 except 블록 수정 (thermis/thermisapp.py, motor/motorapp.py)
- **완료**: 하드코딩된 값 상수화 (lib/type_hints.py)
- **완료**: print 문 통합 (thermal_camera/thermo_camera.py, tmp007/tmp007.py)

### 3단계: 전체 코드베이스 개선사항 분석 및 구현 🔄

#### 3.1 로깅 시스템 통합 ✅
**문제**: 3개의 로깅 시스템이 중복되어 존재
- `lib/logging.py` - DualLogger 클래스
- `lib/dual_logging.py` - DualLogger 클래스 (다른 구현)
- `lib/unified_logging.py` - UnifiedLogger 클래스

**해결 완료**:
1. ✅ 통합 로깅 시스템으로 통합 (`lib/logging/unified_logging.py`)
2. ✅ 중복 파일들 제거 (`dual_logging.py`, `logging.py` 삭제)
3. ✅ 기존 코드와의 호환성 유지 (`safe_log` 함수 호환)
4. ✅ 로깅 패키지 구조화 (`lib/logging/` 디렉토리)

#### 3.2 기본 앱 클래스 생성 ✅
**문제**: 모든 앱 파일에서 동일한 패턴이 반복됨
- `safe_log` 함수 정의 (각 앱마다 거의 동일)
- `command_handler` 함수 구조
- `send_hk` 함수 구조
- `resilient_thread` 함수 구조
- 초기화/종료 함수 구조

**해결 완료**:
1. ✅ 기본 앱 클래스 생성 (`lib/base_app.py`)
2. ✅ 공통 함수들을 기본 클래스로 이동
3. ✅ 센서 앱과 통신 앱을 위한 특화 클래스 생성
4. ✅ 추상 메서드를 통한 인터페이스 정의

#### 3.3 파일 구조 개선 ✅
**문제**: lib 디렉토리에 너무 많은 파일이 집중됨
- 현재 25개의 파일이 lib 디렉토리에 있음
- 관련 기능들이 분산되어 있음

**해결 완료**:
1. ✅ lib 디렉토리를 하위 디렉토리로 분리:
   - `lib/logging/` - 로깅 관련 파일들 ✅
   - `lib/optimization/` - 최적화 관련 파일들 ✅
   - `lib/hardware/` - 하드웨어 관련 파일들 ✅
   - `lib/core/` - 핵심 기능 파일들 ✅
2. ✅ 각 하위 디렉토리에 `__init__.py` 파일 생성
3. ✅ 메인 `lib/__init__.py` 업데이트

#### 3.4 Raspberry Pi Camera v2 제거 ✅
**문제**: Raspberry Pi Camera v2 관련 코드가 불필요하게 남아있음
- `camera/` 디렉토리 및 모든 관련 파일들
- `main.py`에서 camera 앱 로드 코드
- `lib/core/appargs.py`에서 CameraAppArg 클래스
- `flight_logic/flightlogicapp.py`에서 camera 관련 함수들

**해결 완료**:
1. ✅ `camera/` 디렉토리 완전 삭제
2. ✅ `main.py`에서 camera 앱 로드 코드 제거
3. ✅ `lib/core/appargs.py`에서 CameraAppArg 클래스 제거
4. ✅ `flight_logic/flightlogicapp.py`에서 camera 관련 함수들 제거
5. ✅ 관련 import 및 참조 정리

#### 3.5 중복되는 설정 파일들 🔄
**문제**: 여러 설정 관련 파일들이 존재
- `lib/config.py`
- `lib/config.json`
- 각 앱별 설정 파일들

**해결 방안**:
1. 통합 설정 관리 시스템 구축
2. 환경별 설정 분리 (개발/테스트/운영)

#### 3.6 테스트 파일 정리 🔄
**문제**: 테스트 파일들이 여러 위치에 분산
- `test/` 디렉토리
- 각 앱 디렉토리 내 테스트 파일들
- 루트 디렉토리의 테스트 파일들

**해결 방안**:
1. 모든 테스트 파일을 `test/` 디렉토리로 통합
2. 테스트 구조 체계화

## 📊 개선 우선순위

### 🔴 높은 우선순위 (즉시 해결 필요) ✅
1. **로깅 시스템 통합** - 중복 제거 및 성능 향상 ✅
2. **기본 앱 클래스 생성** - 코드 중복 제거 ✅
3. **lib 디렉토리 구조 개선** - 파일 정리 ✅
4. **Raspberry Pi Camera v2 제거** - 불필요한 코드 제거 ✅

### 🟡 중간 우선순위 (단계적 해결)
1. **설정 시스템 통합** - 관리 효율성 향상
2. **테스트 파일 정리** - 구조 개선
3. **문서 업데이트** - README 파일들 통합

### 🟢 낮은 우선순위 (여유 있을 때)
1. **코드 스타일 통일** - PEP 8 준수
2. **타입 힌트 추가** - 코드 품질 향상
3. **성능 최적화** - 메모리 사용량 개선

## 🎯 예상 효과

### 코드 품질 향상
- **중복 코드 제거**: 약 30-40% 코드량 감소
- **유지보수성 향상**: 공통 기능 중앙화
- **버그 감소**: 중복 구현으로 인한 불일치 제거

### 성능 개선
- **메모리 사용량 감소**: 중복 로깅 시스템 제거
- **시작 시간 단축**: 불필요한 초기화 제거
- **디스크 사용량 감소**: 중복 파일 제거

### 개발 효율성 향상
- **새 앱 추가 용이성**: 기본 클래스 상속으로 빠른 개발
- **디버깅 효율성**: 통합된 로깅 시스템
- **설정 관리 편의성**: 중앙화된 설정 시스템

## 📈 총 절약 효과 (업데이트)
- **Pitot 관련 파일 완전 제거**: pitot 디렉토리 및 모든 관련 파일 삭제
- **코드 품질 개선**: 빈 except 블록 수정, 하드코딩된 값 상수화, print 문 통합
- **로깅 시스템 통합**: 3개 시스템 → 1개 시스템으로 통합 ✅
- **기본 앱 클래스 도입**: 앱별 중복 코드 제거 ✅
- **lib 디렉토리 구조 개선**: 파일 분류 및 정리 ✅
- **Raspberry Pi Camera v2 제거**: camera 디렉토리 및 관련 코드 완전 제거 ✅

## ✅ 완료된 작업
- **Pitot 제거**: 불필요한 pitot 관련 코드 완전 제거
- **코드 품질 개선**: 빈 except 블록 수정, 하드코딩된 값 상수화, print 문 통합
- **전체 코드베이스 분석**: 중복 코드 및 개선사항 식별
- **로깅 시스템 통합**: 중복 로깅 시스템 제거 및 통합 시스템 구축
- **기본 앱 클래스 생성**: 공통 기능 추출 및 기본 클래스 구현
- **lib 디렉토리 구조 개선**: 파일 분류 및 패키지 구조화
- **Raspberry Pi Camera v2 제거**: camera 관련 코드 완전 제거

## 🔄 진행 중인 작업
- **설정 시스템 통합**: 중앙화된 설정 관리 시스템 설계
- **테스트 파일 정리**: 분산된 테스트 파일들 통합

## 📋 다음 단계
1. **설정 시스템 통합 구현**
2. **테스트 파일 정리 및 구조화**
3. **기본 앱 클래스 적용**: 기존 앱들을 새로운 기본 클래스로 마이그레이션
4. **문서 업데이트**: 새로운 구조에 맞는 README 파일들 업데이트

## 📊 최종 결과
- **코드베이스 정리**: 불필요한 파일 및 코드 제거
- **Pitot 제거**: 불필요한 pitot 관련 코드 완전 제거
- **Raspberry Pi Camera v2 제거**: 불필요한 camera 관련 코드 완전 제거
- **코드 품질 향상**: 예외 처리 개선, 상수 정의, 로깅 시스템 통합
- **구조 개선**: 중복 코드 제거, 파일 구조 최적화
- **유지보수성 향상**: 공통 기능 중앙화, 설정 시스템 통합
- **개발 효율성 향상**: 기본 앱 클래스로 새로운 앱 개발 용이성 증대 