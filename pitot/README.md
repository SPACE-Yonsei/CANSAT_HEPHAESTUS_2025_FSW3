# Pitot 앱

Pitot tube 차압 센서를 위한 앱 모듈입니다.

## 기능

- **차압 측정**: ±500 Pa 범위의 차압 측정
- **온도 측정**: -40 ~ +85 °C 범위의 온도 측정
- **유속도 계산**: 베르누이 방정식을 사용한 실시간 유속도 계산
- **총압/정압 추정**: 차압을 기반으로 한 총압과 정압 계산
- **고도 보정**: 고도에 따른 공기 밀도 변화를 고려한 유속도 계산
- **20Hz 샘플링**: 50ms 간격으로 데이터 수집
- **캘리브레이션**: 압력 및 온도 오프셋 지원
- **로그 저장**: `logs/pitot/`에 상세 데이터 저장
- **메시지 버스**: 다른 앱들과 통신

## 파일 구조

```
pitot/
├── __init__.py          # 패키지 초기화
├── pitot.py             # Pitot 센서 헬퍼 모듈 (유속도 계산 포함)
├── pitotapp.py          # Pitot 앱 메인 모듈
├── pitot_test.py        # 단독 테스트 스크립트
└── README.md           # 이 파일
```

## 센서 사양

- **센서**: Pitot tube differential-pressure sensor
- **차압 범위**: ±500 Pa
- **온도 범위**: -40 ~ +85 °C
- **변환 시간**: 35ms
- **통신**: I2C (General Call Address 0x00)
- **샘플링**: 20Hz (50ms 간격)

## 유속도 계산

### 베르누이 방정식
```
v = √(2 × ΔP / ρ)
```
여기서:
- `v`: 유속도 (m/s)
- `ΔP`: 동압 (Pa) - 차압과 동일
- `ρ`: 공기 밀도 (kg/m³)

### 공기 밀도 계산
고도에 따른 공기 밀도 변화를 고려합니다:
- **해수면**: 1.225 kg/m³
- **고도 보정**: 국제표준대기모델 사용

## 연결

- **VCC**: 3.3V
- **GND**: Ground
- **SDA**: I2C SDA
- **SCL**: I2C SCL

## 사용법

### 단독 실행
```bash
cd pitot
python3 pitot_test.py
```

### 메인 앱에서 실행
```bash
python3 main.py
```

### 유속도 계산 테스트
```bash
cd test
python3 test_pitot_airspeed.py
```

## 데이터 형식

### 로그 파일 (`logs/pitot/high_freq_pitot_log.csv`)
```
timestamp,pressure,temperature,airspeed,total_pressure,static_pressure
2024-01-01 12:00:00.123,25.5,23.5,6.39,101350.5,101325.0
2024-01-01 12:00:00.173,30.2,23.6,7.02,101355.2,101325.0
```

### 메시지 버스 데이터

#### FlightLogic용 (기존 호환성)
```
"pressure,temperature"
```

#### Telemetry용 (확장)
```
"pressure,temperature,airspeed,total_pressure,static_pressure"
```

### 텔레메트리 데이터 필드
1. **pressure**: 차압 (Pa)
2. **temperature**: 온도 (°C)
3. **airspeed**: 유속도 (m/s)
4. **total_pressure**: 총압 (Pa)
5. **static_pressure**: 정압 (Pa)

## 캘리브레이션

캘리브레이션 명령어를 통해 압력과 온도 오프셋을 설정할 수 있습니다:

```
CAL:pressure_offset,temperature_offset
```

예: `CAL:0.5,1.2`

## 유속도 참고값

| 시나리오 | 차압 (Pa) | 유속 (m/s) | 유속 (km/h) |
|---------|-----------|------------|-------------|
| 정지 상태 | 0 | 0.0 | 0.0 |
| 걸음 속도 | 2 | 1.81 | 6.5 |
| 자전거 속도 | 10 | 4.04 | 14.5 |
| 자동차 30km/h | 50 | 9.04 | 32.5 |
| 자동차 60km/h | 200 | 18.08 | 65.1 |
| 비행기 이착륙 | 500 | 28.58 | 102.9 |

## 고도 보정

고도가 증가할수록 공기 밀도가 감소하여 같은 차압에 대해 유속도가 증가합니다:

| 고도 (m) | 공기 밀도 (kg/m³) | 보정 계수 |
|----------|------------------|-----------|
| 0 | 1.225 | 1.000 |
| 1000 | 1.112 | 1.051 |
| 2000 | 1.007 | 1.104 |
| 3000 | 0.909 | 1.160 |
| 4000 | 0.819 | 1.219 |
| 5000 | 0.736 | 1.282 |

## 오류 처리

- **센서 읽기 실패**: 기본값 (0.0) 사용
- **유속도 계산 오류**: 0.0 m/s 반환
- **연결 오류**: 로그에 기록하고 재시도

## 성능

- **샘플링 주파수**: 20Hz
- **응답 시간**: < 100ms
- **정밀도**: ±2% (유속도)
- **정확도**: ±5% (전체 시스템) 